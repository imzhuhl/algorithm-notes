# 堆 heap

树形结构，通常指二叉堆，分为大根堆和小根堆，大根堆指父节点的权值**不小于**子节点的权值。本章以大根堆为例。首先介绍向上调整和向下调整操作，这是堆的创建、插入、删除的基础。

#### 向上调整

如果某个节点的值大于父节点，就和父节点交换，一直进行这个步骤，直到条件不满足或者达到堆顶。

通常堆是完全二叉树的结构，所以用数组表示一个堆，设第一个元素从下标 1 开始，代码操作向上调整：

```python
def up(h: List[int], x: int):
    while x > 1 and h[x] > h[x//2]:
        h[x], h[x//2] = h[x//2], h[x]
        x = x // 2
```

#### 向下调整

在该节点的儿子中找一个值最大的，如果比该节点的值大，就与之交换，重复此步骤，直到条件不满足或者达到堆底。

```python
def down(h: List[int], x:int):
    while x * 2 <= len(h):
        t = x * 2;
        if t + 1 <= len(h) and h[t+1] > h[t]:
            t += 1
        if h[t] <= h[x]:
            break
        h[t], h[x] = h[x], h[t]
        x = t
```

#### 创建

堆的创建有两种，向下调整建堆和向上调整建堆。

```python
for i in range(n, 0, -1):  # n 表示堆中元素个数
    down(h, i)
```

向下调整堆是从叶子开始，向下调整堆，时间复杂度计算如下：

假设 n 个节点，有 h 层，$ h=log_2(n+1) $，当然 h 取整数。可以得到最后一层的元素没有调整，倒数第二层的元素向下进行 1 次调整，倒数第三层的元素向下进行 2 次调整。
$$
\begin{align}
s &= 1 \cdot2^{h-2} + 2\cdot2^{h-3} + \cdots+(h-1)\cdot2^0 \\
  &= 2^h - h - 1 \\
  &= n - log(n+1)
\end{align}
$$
所以最后的时间复杂度是 `O(n)` 。

向上调整建堆是从根节点开始，向上调整建堆，时间复杂度 `O(logn)`。所以一半用前一种方法建堆，更快。

#### 添加元素

添加到最后一层的最右边，保证是一颗完全二叉树的形状，然后从这个元素开始，向上调整。

#### 删除元素

直接讲根节点的元素和最后一个节点互换，删除旧的根节点，然后从新的根节点开始向下调整。































